from aiogram import types
from loader import dp, bot
from filters import IsPrivate
from utils.misc import rate_limit
from utils.db_api import quick_commands
from keyboards.default import kb_menu


@rate_limit(limit=5, key="/start")
@dp.message_handler(IsPrivate(), text='/start')
async def command_start(message: types.Message):
    try:
        user = await quick_commands.select_user(message.from_user.id)
        if user:
            await bot.send_message(chat_id=message.from_user.id,
                                   text="<b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ù–∞—à —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç</b>üëã!",
                                   reply_markup=kb_menu())
        else:
            await bot.send_message( chat_id=message.from_user.id,
                                    text=F"–ü—Ä–∏–≤–µ—Ç {message.from_user.full_name}üëã!\n"
                                         F"–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º –ø—Ä–æ–π–¥–∏ —Ä–µ–≥–µ—Å—Ç—Ä–∞—Ü–∏—é –∑–¥–µ—Å—å -> /registerüñ•" )

    except Exception as e:
        print( f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {e}" )
        pass
